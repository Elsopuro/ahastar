\section{Hierarchical planning}
Given a suitable graph abstraction, we can once more turn our attention back to agent planning. 
We begin by using the $x,y$ coordinates of the start node to identify the local cluster the agent is located in. This is simple for small agents but large agents may be overlapping across several clusters. Such cases may appear problematic, however, recalling our results from theorem \ref{aha-theorem:reducibility}, we know that only the top-left corner of the area the agent is occupying is important.
\par \indent
Next, we insert the start and goal into the abstract graph using a similar process to that described in \cite{botea04} but substituting A* for AA*. This phase involves $n+m$ searches in total, corresponding to the number of combined transitions in the start and goal clusters.
\par \indent
To compute a high-level plan we again use a variation on A* -- this time to evaluate the annotations of abstract edges before adding a node to the open list.
Once the search terminates we can take the result, and, if immediate execution is not necessary, we are finished. 
Otherwise, we refine the plan by performing a number of small searches between each pair of nodes along the abstract optimal path. 
We can optionally skip this step if we cache the result of our previous searches while building the abstraction, in another classic case of performance vs space tradeoff. 
\par \indent
This completes the description of our final algorithm: Annotated Hierarchical A* (AHA* for short).
